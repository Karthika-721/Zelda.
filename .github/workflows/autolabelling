name: Auto-Label Issues Based on Description

on:
  issues:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest

    steps:
      - name: Authenticate GitHub CLI
        run: echo "${{ secrets.GH_TOKEN }}" | gh auth login --with-token

      - name: Retrieve Issue Description
        id: get_description
        run: |
          ISSUE_BODY=$(gh issue view ${{ github.event.issue.number }} --json body | jq -r '.body')
          echo "ISSUE_BODY=${ISSUE_BODY}" >> $GITHUB_ENV

      - name: Add Labels Based on Keywords
        run: |
          if echo "${{ env.ISSUE_BODY }}" | grep -i 'bug'; then
            gh issue edit ${{ github.event.issue.number }} --add-label "bug"
          fi

          if echo "${{ env.ISSUE_BODY }}" | grep -i 'enhancement'; then
            gh issue edit ${{ github.event.issue.number }} --add-label "enhancement"
          fi

          if echo "${{ env.ISSUE_BODY }}" | grep -i 'documentation'; then
            gh issue edit ${{ github.event.issue.number }} --add-label "documentation"
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
